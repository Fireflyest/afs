参赛队伍按照题目要求提交论文和代码（代码作为论文附件与论文一起提交），以及其他需要展示的支持材料（如有）。

论文的行文不做具体要求，但是需要包含
题号、标题、全体作者以及单位、联系方式、签名、摘要、正文等
正文需包含
* 问题分析
* 模型分析
* 技术路线
* 数值结果
* 结果分析与总结
* 创新点（亮点）介绍
* 参考文献（如有）等内容


> 参赛队伍按照题目要求提交论文和代码（代码作为论文附件与论文一起提交），以及其他需要展示的支持材料（如有）。论文的行文不做具体要求，但是需要包含题号、标题、全体作者以及单位、联系方式、签名、摘要、正文等。正文需包含问题分析、模型分析、技术路线、数值结果、结果分析与总结、创新点（亮点）介绍、参考文献（如有）等内容。


题号 CG2405
# 二型糖尿病(T2D)的预测分类模型

## 摘要
使用机器学习来预测2型糖尿病(Type 2 diabetes，T2D)的发生概率，为实施循证生活方式或药物干预提供了坚实的基础，从而延缓或预防T2D及其并发症的发展。在这项研究中，我们开发了一个机器学习模型，使用包括数3000位健康样本及1000位二型糖尿病患者基础数据，心电数据及生活习惯等数据。首先对基础数据进行预处理，将处理后的数据使用随机森林进行特征重要性排序，取出有效特征。对于心电数据，我们选择将其转化为图像，由卷积网络提取特征后进行特征的融合，从而得出预测结果。心跳间的依赖关系通常需要大量工作进行分析，导致一些隐性的特征时常被忽略，我们使用深度卷积网络是一种更紧凑的端到端的特征提取方法。该模型可以提供关于T2D发生的概率提供有价值的预测，结果表明，融入图像特的模型预测的性能优于单一模型。

## 问题分析
### 介绍
#### 背景
糖尿病，这一以血糖水平持续异常升高为显著特征的慢性代谢性疾病，其根源在于胰岛素的无效利用（胰岛素抵抗）或胰岛素产生不足。随着全球范围内生活节奏的加快、饮食习惯的改变以及人口老龄化的不断加剧，糖尿病已成为一个不容忽视的全球性公共卫生挑战。据2010年的统计数据显示，全球范围内糖尿病的患病率已高达2.85亿人，这一数字占据了成年人总数的6.4%，这数据凸显了糖尿病问题的严峻性。更令人担忧的是，这一趋势并未得到遏制，反而呈现出持续上升的势头。预计到2030年，全球糖尿病患者的数量将激增至5.52亿，这一增长幅度无疑令人咋舌。而更令人警醒的是，按照当前糖尿病的增长速度进行推算，到2040年，全球将有十分之一的成年人患上糖尿病。这一预测不仅揭示了糖尿病问题的普遍性，也提醒我们必须立即采取行动，从源头上遏制糖尿病的蔓延，以保护人类的健康与福祉。面对这一全球性挑战，加强公众对糖尿病的认识、推广健康的生活方式、提高医疗服务的可及性和质量，以及加强国际合作与交流，都将是应对糖尿病问题的关键所在[1]。
#### 意义
糖尿病作为一种慢性疾病，其隐蔽性和复杂性往往使得许多患者未能及时意识到自己的健康状况。一方面，患者可能因为对该疾病的认知不足，忽视了早期可能存在的细微症状；另一方面，部分患者即便已经患病，也可能因为缺乏明显的身体不适而未能察觉到疾病的存在，从而导致近三分之一的糖尿病患者对自己的病情浑然不知。糖尿病若得不到及时有效的管理和控制，其后果将是灾难性的。它不仅会悄无声息地侵蚀患者的肾脏，使其功能逐渐衰退，还可能对心脏构成严重威胁，增加心脏病发作和心力衰竭的风险。此外，神经系统、血管系统和眼睛等关键身体部位也会遭受不同程度的损害，从轻微的神经末梢感觉丧失到严重的视力下降甚至失明，无一不体现出糖尿病的破坏力。因此，利用先进的检测技术对糖尿病进行早期筛查和诊断显得尤为重要。这些技术不仅能够帮助高风险人群及时发现病情，从而采取必要的预防措施，如调整饮食、增加运动、药物治疗等，以遏制疾病的进一步发展；还能够提高患者对疾病管理的参与度，使他们更加积极地配合治疗，从而改善整体健康状况，提升生活质量[2]。
#### 相关工作
为促进T2D早期发现，已开展多项ML技术研究，涵盖筛查、诊断和预测工具。芬兰西部博特尼亚前瞻性研究测试了2293名非糖尿病者的T2D候选基因变异，基于家庭，邀请T2D患者及家属参与。18-70岁、空腹血糖<11 mmol/l者接受OGTT。无糖尿病的18-70岁参与者（T2D家属或对照组）每2-3年回访一次。1990-2002年间，577个家族的1869名T2D亲属和424名对照组参与，中位随访6年。参与者中，1569名糖耐量正常，724名受损。排除MODY突变携带者。按WHO标准定义葡萄糖耐量，获知情同意及伦理批准。禁食12小时后行75g OGTT，测血脂、血糖、胰岛素，计算胰岛素抵抗（HOMA-IR）、β细胞功能（胰岛素生成指数），评估处置指数。研究取得良好结果[3]。此外，有研究提出使用ML模型对韩国人群进行前驱糖尿病筛查，基于KNHANES数据集开发智能筛查模型。用2010年数据（4685例）训练SVM和ANN模型，2011年数据验证。SVM模型表现更佳，AUC值为0.73，该研究专注于识别糖尿病前期状态[1]。

## 模型分析
结合了卷积神经网络和注意力机制的优点，设计了一个新型的T2D及其并发症的预测模型。所提出的模型的结果可以用于处理结构化特征以及12导联心电数据，网络的规模可随输入数据变化。如图所示，可大致将模型网络分为三个部分，即结构化特征处理部分，心电数据特征提取部分以及特征融合和推断部分。

### 残差注意力块
自注意力机制（Self-Attention Mechanism），是一种在深度学习模型中，特别是自然语言处理（NLP）领域中广泛使用的机制。它的核心思想是让模型在处理序列数据时能够关注序列内部的不同部分，从而捕捉序列内部的依赖关系。我们将自注意力机制应用于非序列网络中提取不同特征之间的依赖关系。自注意力机制将输入特征映射为查询（Q）、键（K）和值（V）三组表示。对于输入的每个特征，计算其与输入中所有其他特征的注意力权重。权重是通过查询和键之间的点积（dot product）计算得到的，然后通过softmax函数进行归一化，使得所有权重的和为1。在注意力模块后面接入ReLU激活函数以及线性全连接层，同时使用0.4的Dropout的正则化技术，它的主要作用是防止模型过拟合，由于 Dropout 每次训练只使用部分神经元，这迫使网络不能依赖于任何一个神经元，从而鼓励网络学习到更加鲁棒的特征表示，增强了模型的泛化能力。在将模块应用至网络的同时接入残差连接（Residual Connection），将前一层的输出直接加到更深层的输出上，残差连接的核心思想是允许网络中的信息通过一个直接的路径（即残差路径）传递，这样可以缓解梯度消失或梯度爆炸的问题。这样可以在推理过程中保留浅层的语义信息，减少激活函数所带来的消除影响。

### 深度卷积骨干网络
将十二导联的心电数据作为输入，经过数据预处理后转化为图像输入到卷积网络进行特征提取，其中卷积网络由ResNet（Residual Network）与卷积注意力模块（Convolutional Block Attention Module，简称CBAM）构成。ResNet，全称残差网络，是一种深度学习架构，由微软研究院的Kaiming He等人在2015年提出，主要用于解决深度神经网络训练中的退化问题。我们采用的是34层的ResNet变体，并在其中加入卷积注意力模块。卷积注意力模块是一种用于前馈卷积神经网络（CNN）的注意力机制模块，它通过强调通道轴和空间轴上的关键特征来增强模型的特征提取能力
，作为一个简单而有效的注意力机制，可以广泛应用于提高CNN的表示能力。在残差块中，跳跃连接的权重是与卷积层共享的，减少了模型的参数数量。在理想情况下，如果卷积层的权重是恒等映射，那么残差块的输出将与输入相同，这为网络提供了一个良好的初始化。我们在网络的末尾加入全局平均池化（Global Average Pooling，简称GAP）将特征图（feature maps）转换为固定长度的向量。全局平均池化可以替代全连接层来减少参数数量和计算量，同时保持或提高模型性能。因此我们不需要固定输入图片的大小，即不需要对输入图片进行裁剪，能够最大程度的保留特征的完整性。

### 用交叉注意力融合特征
特征融合的最简单方式是直接的特征拼接，在进行特征融合之前，首先需要从图像和向量数据中提取特征，将图像和文本等不同模态的数据转换成统一的特征向量。特征级融合是在提取特征后立即将不同模态的特征连接成一个高维特征向量的方法。这种方法简单直接，但可能导致维度灾难和信息冗余。我们的残差注意力块的注意力机制将输入特征映射为查询（Q）、键（K）和值（V）三组表示。其中将心电图提取的特征作为查询（Q），将基础数据所提取的特征作为键（K）和值（V），用于拟合两者的相关性，从而增强网络的性能。

## 技术路线
### 基础数据处理
数据集的标准化对许多学习方法都至关重要，良好的特征预处理可以显著提高模型的性能、加速训练过程，并帮助模型更好地泛化。

数据集的生活习惯和血液数据宝航大量缺失值。有空缺的数据集无法直接进行训练。如果丢弃包含缺失值的整行或整列，可能丢失太多有价值的数据。于是我们进行缺失值插补，即从数据的已知部分推断它们。
与基础数据和生活习惯数据不同，血液数据的缺失是行缺失，即某个eid下缺失一整行，所以我们采用的方式是对前两种数据进行空缺填补，再根据前两种数据填补血液的空缺数据。

对于基础数据和生活习惯数据，我们使用的填补方式是多变量特征插补（Multivariate feature imputation）将每个具有缺失值的特征建模为其他特征的函数，并使用该估计值进行插补。它以迭代的循环方式执行此操作：在每个步骤中，一个特征列被指定为输出 y，其他特征列被视为输入 X。回归器适合已知 y 的 （X， y）。然后，使用回归量来预测 y 的缺失值。这是以迭代方式对每个特征完成的，然后对max_iter插补轮次重复此操作。将返回最后一轮插补的结果。
使用的估计器是贝叶斯岭回归（BayesianRidge），特征之间的接近度是使用每个特征对之间的绝对相关系数（使用均值初始插补后）来测量的。为了确保在整个插补过程中覆盖特征，相邻特征不一定是最近的，而是以与每个插补目标特征的相关性成正比的概率绘制的。特征数量越多，拟合的越快。

对于血液数据的插补，我们使用的是K近邻插补。默认情况下，支持缺失值的欧氏距离度量标准用于查找最近的邻域。每个缺失的特征都使用具有特征值的最近邻的值进行插补。相邻要素的要素将统一平均或按到每个相邻要素的距离进行加权。

将特征缩放到相同的尺度，使得模型训练更加稳定，加快收敛速度。使用最小最大归一化（Min Max Scaling）处理，将特征缩放到给定的最小值和最大值之间，这里的最大值和最小值分别取0和1。
使用这种缩放的是为了得到非常小的特征标准差，提高模型的鲁棒性，以及在稀疏数据中保留零条目。

由于特征数量过多，训练成本过高，我们使用随机森林分类器分别对基本特征和血液特征计算特征的重要性，选取排名靠前的特征进行训练。例如，基础特征和血液特征最重要的分别是BMI与血糖。但是特征的排行并无法获取特征之间的隐性关系，我们还是最大程度的保留特征的数量。

将处理完的结构化特征输入残差注意力块进行一次特征处理，后续与十二导联心电图提取的特征进行融合，提高模型的性能。

### 心电数据特征提取

糖尿病与心血管疾病之间存在密切的关系。糖尿病患者由于多种生理和代谢异常，更容易发展成心血管疾病。
心电图（ECG）在心血管疾病的诊断中扮演着至关重要的角色。它是一种无创、便捷且准确的检查方法，被誉为心血管健康的“晴雨表”。
心电图技术在心血管疾病的诊断和治疗中发挥着不可替代的作用，能够为医生提供宝贵的诊断依据和治疗指导。
然而，要理解心电图波形需要专业培训和专业知识。即使是人类专家，手动心电图分析也是一项耗时且容易出错的任务。因此，自动心电图分析算法变得越来越重要。
对于手动提取特征，对于同一疾病的不同患者，有时可以提取出截然不同的ECG形态特征。
与传统的心电提取特征方法相比，利用卷积神经网络提取心电图特征不需要显式的心跳分割，是一种更紧凑的端到端心律失常检测办法。
原始的数据为$X_{ecg}\in \mathbb{R}^{l \times 12}$的序列数据，每个eid对应的数据包括十二导联500Hz的十秒心电数据。

由于心电数据是未经过处理，含噪声的数据，为了降低特征的提取难度，我们使用小波变换进行降噪处理。
小波去噪是一种基于小波变换的信号处理技术，广泛应用于图像处理、生物医学信号处理、音频处理等领域。它的核心原理是利用小波变换将信号分解到不同频率的小波子空间，然后对小波系数进行处理，以去除噪声并保留信号的主要特征。
首先读取数据，并选择一个小波基并确定分解层次，对信号进行多层小波分解。对高频小波系数进行阈值量化处理，以去除噪声。这个过程涉及到对小波系数的统计特性进行分析，选择一个合适的阈值，将小于阈值的系数置为零，从而去除噪声。最后通过小波逆变换将处理后的系数重构为去噪后的信号。

去除噪声后，将十二导联心电数据作为折线画在同一幅图上。如图所示，十二导联心电图由6个肢体导联（Ⅰ、Ⅱ、Ⅲ、aVR、aVL、aVF）和6个胸导联（V1~V6）组成。其中，肢体导联包括标准双极导联（Ⅰ、Ⅱ和Ⅲ）和加压导联（aVR、aVL和aVF）。由于图像特征提取网络的最后一层使用的全局平均池化代替全连接展开，我们不需要对图片进行裁剪。

### 特征的融合
多模态特征融合是深度学习一种常用的技术，它将来自不同模态（如文本、图像、音频等）的特征结合起来，以获得更全面、更准确的信息表示
。本模型使用特征级融合（早期融合），将不同模态的数据（基础数据和心电图数据）处理后，使用交叉注意力机制进行融合。这种融合方式相比较于简单的特征直接拼接，能够更有效的加强特征之间的隐性关系。


## 数值结果
## 结果分析与总结

## 创新点（亮点）介绍

## 参考文献
[1]	Deberneh H M, Kim I. Prediction of type 2 diabetes based on machine learning algorithm[J]. International journal of environmental research and public health, 2021, 18(6): 3317

[2]	覃伟, 高敏, 沈莹, 等. 基于机器学习算法的 2 型糖尿病患者 3 个月血糖预测[J]. 中华疾病控制杂志, 2019, 23(11): 1313-1317.

[3]	Lyssenko V, Almgren P, Anevski D, et al. Genetic prediction of future type 2 diabetes[J]. PLoS medicine, 2005, 2(12): e345.
